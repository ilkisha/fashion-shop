{% extends 'base.html.twig' %}

{% block title %}Products
{% endblock %}

{% block body %}
	<h1>Products</h1>

	<!-- Search Bar -->
	<div class="search-bar">
		<form method="get" action="{{ path('catalog_index') }}" class="search-form">
			<div class="search-input-wrapper">
				<span class="search-icon">üîç</span>
				<input type="text" name="q" value="{{ q ?? '' }}" placeholder="Search products..." class="search-input">
				{% if gender %}
					<input type="hidden" name="gender" value="{{ gender }}">
				{% endif %}
				{% if category %}
					<input type="hidden" name="category" value="{{ category }}">
				{% endif %}
				<button type="submit" class="search-btn">Search</button>
				{% if q %}
					<a class="search-clear" href="{{ path('catalog_index', { gender: gender, category: category }) }}" title="Clear search">‚úï</a>
				{% endif %}
			</div>
		</form>
	</div>

	<!-- Filter Bar -->
	<div class="filter-bar">
		<span class="text-muted" style="font-weight: 500;">Filter:</span>

		<a href="{{ path('catalog_index', { q: q, category: category }) }}" class="{{ gender is null ? 'active' : '' }}">
			All
		</a>

		<a href="{{ path('catalog_index', { gender: 'men', q: q, category: category }) }}" class="{{ gender == 'men' ? 'active' : '' }}">
			Men
		</a>

		<a href="{{ path('catalog_index', { gender: 'women', q: q, category: category }) }}" class="{{ gender == 'women' ? 'active' : '' }}">
			Women
		</a>

		<a href="{{ path('catalog_index', { gender: 'unisex', q: q, category: category }) }}" class="{{ gender == 'unisex' ? 'active' : '' }}">
			Unisex
		</a>

		<span style="margin-left: auto;"></span>

		<form method="get" action="{{ path('catalog_index') }}" style="display: inline-flex; align-items: center; gap: 0.5rem;">
			{% if gender %}
				<input type="hidden" name="gender" value="{{ gender }}">
			{% endif %}
			{% if q %}
				<input type="hidden" name="q" value="{{ q }}">
			{% endif %}

			<label for="category" class="text-muted" style="font-weight: 500;">Category:</label>
			<select id="category" name="category" onchange="this.form.submit()">
				<option value="">All categories</option>
				{% for c in categories %}
					<option value="{{ c }}" {{ c == category ? 'selected' : '' }}>
						{{ c }}
					</option>
				{% endfor %}
			</select>
		</form>
	</div>

	{% if products is empty %}
		<div class="empty-state">
			<div class="empty-state-icon">üîç</div>
			<h2>No products found</h2>
			<p class="text-muted">Try adjusting your filters or check back later.</p>
			<a href="{{ path('catalog_index') }}" class="btn btn-secondary mt-2">Clear filters</a>
		</div>
	{% else %}
		<div class="product-grid">
			{% for product in products %}
				<div class="card product-card">
					<div style="position: relative;">
						{% if product.imagePath %}
							<a href="{{ path('catalog_show', {slug: product.slug}) }}">
								<img src="{{ asset('uploads/products/' ~ product.imagePath) }}" alt="{{ product.name }}">
							</a>
						{% else %}
							<a href="{{ path('catalog_show', {slug: product.slug}) }}" style="display: block; width: 100%; height: 200px; background: var(--color-bg); display: flex; align-items: center; justify-content: center;">
								<span style="font-size: 3rem;">üëó</span>
							</a>
						{% endif %}
						{% if product.stockQuantity <= 0 %}
							<div class="out-of-stock-badge">Out of Stock</div>
						{% endif %}
					</div>

					<div class="card-body">
						<h3 style="font-size: 1.1rem; margin-bottom: 0.25rem;">
							<a href="{{ path('catalog_show', {slug: product.slug}) }}" style="color: var(--color-primary);">
								{{ product.name }}
							</a>
						</h3>
						<div class="text-muted" style="font-size: 0.85rem; margin-bottom: 0.5rem;">
							{{ product.category }}
							‚Ä¢
							{{ product.gender }}
						</div>
						<div style="font-size: 1.25rem; font-weight: 600; color: var(--color-accent);">
							{{ product.price }}
							EUR
						</div>

						<div class="product-actions">
							{% if product.stockQuantity > 0 %}
								<form method="post" action="{{ path('cart_add', {id: product.id}) }}">
									<input type="hidden" name="quantity" value="1">
									<button type="submit" class="btn btn-primary btn-block">
										üõí Add to cart
									</button>
								</form>
							{% else %}
								<button type="button" class="btn btn-secondary btn-block" disabled>
									‚ùå Out of Stock
								</button>
							{% endif %}
						</div>
					</div>
				</div>
			{% endfor %}
		</div>
	{% endif %}
{% endblock %}
